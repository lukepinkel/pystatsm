#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu May  4 22:37:28 2023

@author: lukepinkel
"""

import numpy as np
CONST = -1/2*np.log(np.pi) - 1/2*np.log(2)

def _logpdf4(y, m, s, t, v):  
    x0 = t*np.arcsinh((m - y)/s) + v
    lnp = np.log(t) - 1/2*np.log(m**2 - 2*m*y + s**2 + y**2) +\
          np.log(np.cosh(x0)) - 1/2*np.sinh(x0)**2 + CONST# -1/2*np.log(np.pi) - 1/2*np.log(2)

    x1 = s**2
    x2 = 2*y
    x3 = m**2 - m*x2 + x1 + y**2
    x4 = 1/x3
    x5 = 2*m - x2
    x6 = (1/2)*x5
    x7 = 1/s
    x8 = m - y
    x9 = np.arcsinh(x7*x8)
    x10 = t*x9
    x11 = v + x10
    x12 = np.sinh(x11)
    x13 = np.cosh(x11)
    x14 = x12*x13
    x15 = 1/x1
    x16 = x8**2
    x17 = x15*x16 + 1
    x18 = 1/np.sqrt(x17)
    x19 = x18*x7
    x20 = t*x19
    x21 = 1/x13
    x22 = x12*x21
    x23 = x15*x18
    x24 = t*x23
    x25 = x24*x8
    x26 = x14*x9
    x27 = x22*x9
    x28 = t**2
    x29 = 1/x17
    x30 = -x5
    x31 = x3**(-2)
    x32 = x31*x5
    x33 = x12**2
    x34 = x15*x29
    x35 = x28*x34
    x36 = x13**2
    x37 = 1/x36
    x38 = x33*x37
    x39 = s**3
    x40 = 1/x39
    x41 = x17**(-3/2)
    x42 = t*x41
    x43 = x40*x42
    x44 = x22*x43
    x45 = x28*x29
    x46 = x40*x8
    x47 = x45*x46
    x48 = s**4
    x49 = 1/x48
    x50 = x16*x49
    x51 = x42*x50
    x52 = x19*x33
    x53 = x19*x36
    x54 = x14*x19
    x55 = x10*x19
    x56 = x45*x50
    x57 = t*x18
    x58 = 2*x46
    x59 = x57*x58
    x60 = s**(-5)
    x61 = x8**3
    x62 = x60*x61
    x63 = x42*x62
    x64 = x23*x8
    x65 = x10*x64
    x66 = x33*x64
    x67 = x36*x64
    x68 = x14*x64
    x69 = x22*x64
    x70 = x9**2
    x71 = x33*x70
    x72 = x36*x70
    x73 = x37*x71
    x74 = x33*x9
    x75 = x36*x9
    x76 = x37*x74
    x77 = 2*x31
    x78 = -x31*x5
    x79 = x17**(-2)
    x80 = x49*x79
    x81 = x28*x80
    x82 = (3/2)*x5
    x83 = x3**(-3)
    x84 = -4*m + 4*y
    x85 = x30*x83*x84
    x86 = 4*x14
    x87 = t**3
    x88 = x40*x41
    x89 = x87*x88
    x90 = 2*x22
    x91 = x12**3
    x92 = x13**(-3)
    x93 = x5**2
    x94 = (3/4)*x93
    x95 = x17**(-5/2)
    x96 = t*x95
    x97 = x60*x96
    x98 = x94*x97
    x99 = 2*x40
    x100 = x45*x99
    x101 = x28*x79
    x102 = x16*x60
    x103 = 2*x102
    x104 = x101*x103
    x105 = 2*x5
    x106 = x60*x8
    x107 = x101*x106
    x108 = x107*x6
    x109 = x107*x33
    x110 = x107*x36
    x111 = x42*x49
    x112 = x111*x82
    x113 = x41*x87
    x114 = x49*x8
    x115 = x113*x114
    x116 = x91*x92
    x117 = 2*x116
    x118 = s**(-6)
    x119 = x118*x16
    x120 = x119*x82
    x121 = x120*x96
    x122 = 2*x34
    x123 = t*x122
    x124 = x10*x88
    x125 = x22*x88
    x126 = 4*x26
    x127 = 2*x9
    x128 = x127*x22
    x129 = x43*x6
    x130 = x1*x83
    x131 = 4*x5
    x132 = 3*x101
    x133 = x118*x61
    x134 = 4*x33
    x135 = x45*x49
    x136 = x135*x8
    x137 = 4*x36
    x138 = x57*x99
    x139 = s**(-7)
    x140 = x8**4
    x141 = x139*x140
    x142 = 3*x96
    x143 = x141*x142
    x144 = 5*x102
    x145 = x144*x42
    x146 = x102*x113
    x147 = t*x29
    x148 = x147*x58
    x149 = x10*x23
    x150 = x41*x50
    x151 = x10*x150
    x152 = x23*x33
    x153 = x23*x36
    x154 = x150*x33
    x155 = x150*x36
    x156 = 2*x19
    x157 = x70*x86
    x158 = 2*x70
    x159 = x158*x22
    x160 = 8*x83
    x161 = x132*x141
    x162 = 6*x102
    x163 = x162*x45
    x164 = 6*x57
    x165 = x114*x164
    x166 = s**(-8)
    x167 = x8**5
    x168 = x166*x167
    x169 = x142*x168
    x170 = 7*x133
    x171 = x170*x42
    x172 = x113*x133
    x173 = x41*x62
    x174 = x10*x173
    x175 = x147*x50
    x176 = 2*x175
    x177 = x18*x58
    x178 = x177*x33
    x179 = x177*x36
    x180 = 2*x64
    x181 = x116*x158
    x182 = x9**3
    x183 = 2*x182
    x184 = -6*x31
    x185 = t**4
    x186 = x185*x80
    x187 = -2*x30*x5*x83
    x188 = x17**(-3)
    x189 = x3**(-4)
    x190 = x189*x30
    x191 = x188*x28
    x192 = (15/4)*x93
    x193 = x118*x192
    x194 = x191*x193
    x195 = 6*x12**4/x13**4
    x196 = x14*x97
    x197 = 8*m - 8*y
    x198 = x5**3
    x199 = x17**(-7/2)
    x200 = t*x199
    x201 = x200*x22
    x202 = 6*x5
    x203 = x202*x60
    x204 = x116*x95
    x205 = s*x30
    x206 = s*x83
    x207 = x106*x79
    x208 = 2*x185
    x209 = x101*x203
    x210 = x139*x191
    x211 = x210*x8*x94
    x212 = x16*x202*x210
    x213 = x189*x5
    x214 = x185*x207
    x215 = 3*x111
    x216 = x113*x49
    x217 = 12*x14
    x218 = 6*x22
    x219 = 6*x116
    x220 = x119*x142
    x221 = x193*x96
    x222 = x87*x95
    x223 = x119*x222
    x224 = 8*x38
    x225 = x118*x8
    x226 = x14*x95
    x227 = x226*x87
    x228 = x14*x200
    x229 = x16*x166*x192
    x230 = x22*x95
    x231 = x230*x87
    x232 = 3*x225
    x233 = x116*x5
    x234 = x222*x233
    x235 = t*x5
    x236 = 4*x74
    x237 = 4*x75
    x238 = x60*x94
    x239 = x10*x238*x95
    x240 = x195*x9
    x241 = 3*x233*x81
    x242 = x208*x79
    x243 = 12*x5
    x244 = 6*x135
    x245 = x140*x166
    x246 = x191*x245
    x247 = 8*x246
    x248 = x185*x79
    x249 = x119*x248
    x250 = (7/2)*x166*x191*x5*x61
    x251 = x106*x113
    x252 = 24*x14
    x253 = x204*x87
    x254 = x139*x61
    x255 = s**(-9)
    x256 = x139*x16
    x257 = 4*x40
    x258 = x147*x257
    x259 = t*x79
    x260 = 4*x102
    x261 = x259*x260
    x262 = x207*x235
    x263 = x147*x40
    x264 = x41*x82
    x265 = x264*x49
    x266 = x10*x265
    x267 = x102*x259
    x268 = x10*x95
    x269 = x120*x268
    x270 = x14*x49
    x271 = x114*x41
    x272 = x271*x28
    x273 = x219*x28
    x274 = x40*x45
    x275 = 8*x26
    x276 = x257*x45
    x277 = x116*x276
    x278 = x101*x102
    x279 = x101*x260
    x280 = 8*x76
    x281 = x116*x279
    x282 = x107*x14
    x283 = x107*x233
    x284 = 2*x113
    x285 = 8*x14
    x286 = 4*x71
    x287 = 4*x72
    x288 = x10*x34
    x289 = 16*x14
    x290 = x195*x70
    x291 = x233*x43
    x292 = t*x34
    x293 = 18*x106*x45
    x294 = 15*x191
    x295 = x167*x255
    x296 = x294*x295
    x297 = 31*x101*x254
    x298 = x248*x254
    x299 = s**(-10)
    x300 = x8**6
    x301 = x299*x300
    x302 = 15*x301
    x303 = 36*x245
    x304 = x14*x96
    x305 = 27*x119
    x306 = x22*x42
    x307 = 36*x119
    x308 = x113*x14
    x309 = 12*x245
    x310 = 18*x119
    x311 = x113*x22
    x312 = 6*x259
    x313 = x144*x41
    x314 = x114*x147
    x315 = 8*x314
    x316 = x18*x99
    x317 = x10*x316
    x318 = 3*x141
    x319 = x10*x318*x95
    x320 = 12*x102
    x321 = x28*x41
    x322 = 8*x136
    x323 = x101*x133*x219
    x324 = 2*x29
    x325 = x324*x46
    x326 = 2*x23
    x327 = 2*x150
    x328 = x10*x29
    x329 = x328*x46
    x330 = 8*x329
    x331 = 8*x73
    x332 = x147*x46
    x333 = 4*x22
    x334 = x134*x182
    x335 = x137*x182
    x336 = 12*x70
    x337 = 6*x70
    x338 = x182*x195
    x339 = 4*x27
    x340 = x294*x301
    x341 = x245*x248
    x342 = x307*x45
    x343 = s**(-11)
    x344 = x8**7
    x345 = 48*x254
    x346 = x141*x312
    x347 = x147*x320
    x348 = x114*x18
    x349 = 6*x348
    x350 = x10*x349
    x351 = 3*x168
    x352 = x268*x351
    x353 = x170*x41
    x354 = x10*x353
    x355 = x133*x321
    x356 = x101*x141
    x357 = x102*x45
    x358 = x320*x45
    x359 = x219*x356
    x360 = x116*x358
    x361 = x324*x50
    x362 = x18*x46
    x363 = x328*x50
    x364 = x46*x57
    x365 = x285*x364
    x366 = x333*x364
    x367 = x10*x362
    x368 = x9**4
 
    x369 = x33 + x36 + x38 - 1
    x370 = x43*x6
    x371 = x127*x47
    x372 = x177*x38
    x373 = x86 + x90
    x374 = x107*x5
    x375 = 8*x22
    x376 = 4*x116
    x377 = x134 + x137 + x195 + 2
    x378 = 8*x33*x37 - x377
  
        
    
    d1L = np.zeros(y.shape+(4,))
    d1L[...,0] = t*x12*x18*x21*x7 - x14*x20 - x4*x6
    d1L[...,1] = -s*x4 + t*x12*x13*x15*x18*x8 - x22*x25
    d1L[...,2] = -x26 + x27 + 1/t
    d1L[...,3] = x12*x21 - x14
    
    
    d2L = np.zeros(y.shape+(10,))
    d2L[...,0] = (1/2)*t*x12*x13*x40*x41*x5 + x15*x28*x29 - 1/2*x30*x32 - x33*x35 - x35*x36 - x35*x38 - x4 - x44*x6
    d2L[...,1] = s*x32 + x14*x24 - x14*x51 - x22*x24 + x22*x51 + x33*x47 + x36*x47 + x38*x47 - x47
    d2L[...,2] = t*x18*x7*x9 - x10*x52 - x10*x53 + x12*x18*x21*x7 - x38*x55 - x54
    d2L[...,3] = t*x18*x7 - x20*x33 - x20*x36 - x20*x38
    d2L[...,4] = t*x12*x13*x41*x60*x61 + 2*t*x12*x18*x21*x40*x8 + 2*x1*x31 - x14*x59 + x16*x28*x29*x49 - x22*x63 - x33*x56 - x36*x56 - x38*x56 - x4
    d2L[...,5] = x10*x66 + x10*x67 + x38*x65 - x65 + x68 - x69
    d2L[...,6] = x25*x369
    d2L[...,7] = x70 - x71 - x72 - x73 - 1/x28
    d2L[...,8] = -x74 - x75 - x76 + x9
    d2L[...,9] = -x369
    
    
    d3L = np.zeros(y.shape+(20,))
    d3L[...,0] = t*x12*x13*x40*x41 + (3/4)*t*x12*x21*x60*x93*x95 - x14*x98 + (3/2)*x28*x33*x37*x49*x5*x79 + (3/2)*x28*x33*x49*x5*x79 + (3/2)*x28*x36*x49*x5*x79 - x30*x77 + 2*x40*x41*x87*x91*x92 - x44 - x6*x85 - x78 - x81*x82 - x86*x89 - x89*x90
    d3L[...,1] = s*x105*x30*x83 + s*x77 + x100*x33 + x100*x36 + x100*x38 - x100 - x104*x33 - x104*x36 - x104*x38 + x104 - x108*x38 + x108 - x109*x6 - x110*x6 - x112*x14 + x112*x22 - x115*x117 + x115*x86 + x115*x90 + x121*x14 - x121*x22
    d3L[...,2] = 2*t*x15*x29 + (1/2)*t*x33*x37*x40*x41*x5*x9 + (1/2)*t*x33*x40*x41*x5*x9 + (1/2)*t*x36*x40*x41*x5*x9 + (1/2)*x12*x13*x40*x41*x5 - x123*x33 - x123*x36 - x123*x38 - x124*x6 - x125*x6 - x126*x35 - x128*x35 + 2*x15*x28*x29*x9*x91*x92
    d3L[...,3] = x117*x35 + x129*x38 - x129 + x33*x370 - x35*x86 - x35*x90 + x36*x370
    d3L[...,4] = 5*t*x12*x13*x16*x41*x60 + 3*t*x12*x139*x140*x21*x95 + 2*t*x12*x18*x21*x40 + 3*x118*x28*x33*x37*x61*x79 + 3*x118*x28*x33*x61*x79 + 3*x118*x28*x36*x61*x79 - x130*x131 - x132*x133 - x134*x136 - x136*x137 - 4*x136*x38 - x138*x14 - x14*x143 - x145*x22 - x146*x86 - x146*x90 + 2*x16*x41*x60*x87*x91*x92 + 4*x28*x29*x49*x8 - x78
    d3L[...,5] = x10*x152 + x10*x153 - x10*x154 - x10*x155 - x116*x371 + x126*x47 + x128*x47 - x14*x150 + x14*x23 + x148*x33 + x148*x36 + x148*x38 - x148 + x149*x38 - x149 + x150*x22 - x151*x38 + x151 - x22*x23
    d3L[...,6] = -x117*x47 + x24*x33 + x24*x36 + x24*x38 - x24 - x33*x51 - x36*x51 - x38*x51 + x47*x86 + x47*x90 + x51
    d3L[...,7] = 2*t*x18*x7*x70*x91*x92 - x156*x74 - x156*x75 - x156*x76 - x157*x20 - x159*x20 + 2*x18*x7*x9
    d3L[...,8] = 2*t*x18*x7*x9*x91*x92 + x18*x7 - x19*x38 - x52 - x53 - x55*x86 - x55*x90
    d3L[...,9] = 2*t*x18*x7*x91*x92 - x20*x86 - x20*x90
    d3L[...,10] = 6*s*x31 - x117*x172 + x14*x165 + x14*x169 - x14*x171 - x160*x39 - x161*x33 - x161*x36 - x161*x38 + x161 + x163*x33 + x163*x36 + x163*x38 - x163 - x165*x22 - x169*x22 + x171*x22 + x172*x86 + x172*x90
    d3L[...,11] = 2*t*x16*x29*x49 + 2*t*x18*x40*x8*x9 + t*x33*x37*x41*x60*x61*x9 + t*x33*x41*x60*x61*x9 + t*x36*x41*x60*x61*x9 - x10*x178 - x10*x179 - x10*x372 + x12*x13*x41*x60*x61 + 2*x12*x18*x21*x40*x8 - x126*x56 - x128*x56 - x14*x177 + 2*x16*x28*x29*x49*x9*x91*x92 - x173*x22 - x174 - x176*x33 - x176*x36 - x176*x38
    d3L[...,12] = 2*t*x18*x40*x8 + t*x33*x37*x41*x60*x61 + t*x33*x41*x60*x61 + t*x36*x41*x60*x61 + 2*x16*x28*x29*x49*x91*x92 - x33*x59 - x36*x59 - x38*x59 - x56*x86 - x56*x90 - x63
    d3L[...,13] = -x127*x64 + x157*x25 + x159*x25 + x180*x74 + x180*x75 + x180*x76 - x181*x25
    d3L[...,14] = -x117*x65 + x38*x64 - x64 + x65*x86 + x65*x90 + x66 + x67
    d3L[...,15] = x25*(-x117 + x373)
    d3L[...,16] = x116*x183 - x182*x86 - x183*x22 + 2/x87
    d3L[...,17] = -x157 - x159 + 2*x70*x91*x92
    d3L[...,18] = -x126 - x128 + 2*x9*x91*x92
    d3L[...,19] = -x373 + 2*x91*x92
    
    
    d4L = np.zeros(y.shape+(35,))
    d4L[...,0] = (15/8)*t*x12*x13*x139*x198*x199 + (3/4)*t*x12*x197*x21*x60*x95 + (3/2)*t*x12*x21*x5*x60*x95 + (15/4)*x118*x188*x28*x93 + 12*x12*x13*x5*x60*x87*x95 + 6*x12*x21*x5*x60*x87*x95 - x134*x186 - x137*x186 - 15/8*x139*x198*x201 - x184 + 8*x185*x33*x37*x49*x79 - x186*x195 - 2*x186 - x187 + 6*x190*x6*x84*(m - y) - x194*x33 - x194*x36 - x194*x38 - 3/4*x196*x197 - x196*x82 - x203*x204*x87 + 4*x28*x33*x37*x49*x79 + 4*x28*x33*x49*x79 + 4*x28*x36*x49*x79 + 2*x5*x83*x84 - 4*x81 - 3*x85
    d4L[...,1] = -x107*x38 + x107 - x109 - x110 - x131*x206 + x134*x214 + x137*x214 - x14*x215 + x14*x220 + x14*x221 + x160*x205 + x195*x214 + x201*x229 - x202*x225*x227 + 3*x205*x213*x84 + x207*x208 - x209*x33 - x209*x36 - x209*x38 + x209 + x211*x33 + x211*x36 + x211*x38 - x211 + x212*x33 + x212*x36 + x212*x38 - x212 - x214*x224 + x215*x22 + x216*x217 + x216*x218 - x216*x219 - x217*x223 - x218*x223 + x219*x223 - x22*x220 - x22*x221 - x228*x229 - x231*x232*x5 + x232*x234
    d4L[...,2] = t*x33*x37*x40*x41*x9 + 3*t*x33*x37*x49*x5*x79 + t*x33*x40*x41*x9 + 3*t*x33*x49*x5*x79 + t*x36*x40*x41*x9 + 3*t*x36*x49*x5*x79 + (3/4)*t*x60*x9*x93*x95 + 6*x12*x13*x28*x49*x5*x79*x9 + x12*x13*x40*x41 + 3*x12*x21*x28*x49*x5*x79*x9 + (3/4)*x12*x21*x60*x93*x95 - x124 - 6*x125*x28 - x125 - x127*x89 - 12*x14*x28*x88 - x226*x238 - 3*x235*x80 - x236*x89 - x237*x89 - x239*x33 - x239*x36 - x239*x38 - x240*x89 - x241*x9 + 6*x28*x40*x41*x91*x92 + 8*x33*x37*x40*x41*x87*x9
    d4L[...,3] = t*x33*x37*x40*x41 + t*x33*x40*x41 + t*x36*x40*x41 + (3/4)*t*x60*x93*x95 - x113*x99 + 6*x12*x13*x28*x49*x5*x79 + 3*x12*x21*x28*x49*x5*x79 - x134*x89 - x137*x89 - x195*x89 - x241 + 8*x33*x37*x40*x41*x87 - x33*x98 - x36*x98 - x38*x98 - x43
    d4L[...,4] = (15/2)*t*x12*x13*x140*x199*x255*x5 + 6*t*x12*x13*x41*x5*x60 + (27/2)*t*x12*x139*x16*x21*x5*x95 - x1*x160 - x1*x190*x243 - 14*x101*x119 - x101*x131*x225 + 8*x118*x16*x185*x33*x37*x79 + 14*x118*x16*x28*x33*x37*x79 + 14*x118*x16*x28*x33*x79 + 14*x118*x16*x28*x36*x79 + 4*x118*x28*x33*x37*x5*x79*x8 + 4*x118*x28*x33*x5*x79*x8 + 4*x118*x28*x36*x5*x79*x8 - x119*x242 + 2*x12*x13*x139*x16*x5*x87*x95 + 20*x12*x13*x139*x61*x87*x95 + x12*x139*x16*x21*x5*x87*x95 + 10*x12*x139*x21*x61*x87*x95 - x134*x249 - x137*x249 + 8*x140*x166*x188*x28 - 15/2*x140*x199*x22*x235*x255 + (7/2)*x166*x188*x28*x5*x61 - x187 - x195*x249 - x203*x22*x42 - 12*x22*x251 - x224*x246 - 27/2*x226*x235*x256 - x234*x256 - x244*x33 - x244*x36 - x244*x38 - x247*x33 - x247*x36 - x250*x33 - x250*x36 - x250*x38 - x251*x252 - 10*x253*x254 + 6*x28*x29*x49 + 2*x31 + 12*x41*x60*x8*x87*x91*x92
    d4L[...,5] = x115*x127 + x115*x236 + x115*x237 + x115*x240 - x115*x280 + x120*x226 - x120*x230 - x127*x282*x5 + x134*x263 - x134*x267 + x137*x263 - x137*x267 + x217*x272 + x218*x272 + x22*x265 + x258*x38 - x258 - x261*x38 + x261 - x262*x33 - x262*x36 - x262*x38 + x262 - x264*x270 - x266*x33 - x266*x36 - x266*x38 + x266 + x269*x33 + x269*x36 + x269*x38 - x269 + x27*x276 - x27*x279 - x27*x374 - x271*x273 + x274*x275 - x275*x278 - x277*x9 + x281*x9 + x283*x9
    d4L[...,6] = -x105*x282 - x112*x33 - x112*x36 - x112*x38 + x112 + x114*x284 + x115*x134 + x115*x137 + x115*x195 - x115*x224 + x121*x33 + x121*x36 + x121*x38 - x121 + x22*x276 - x22*x279 - x22*x374 + x274*x285 - x277 - x278*x285 + x281 + x283
    d4L[...,7] = 2*t*x12*x13*x40*x41*x5*x70 + t*x12*x21*x40*x41*x5*x70 + 8*t*x15*x29*x9*x91*x92 - x122*x33 - x122*x36 - x122*x38 + 8*x15*x28*x29*x33*x37*x70 + 2*x15*x29 - x158*x35 - x286*x35 - x287*x35 - x288*x289 - x288*x375 - x290*x35 - x291*x70 + x33*x37*x40*x41*x5*x9 + x33*x40*x41*x5*x9 + x36*x40*x41*x5*x9 - x5*x88*x9
    d4L[...,8] = 2*t*x12*x13*x40*x41*x5*x9 + t*x12*x21*x40*x41*x5*x9 + 4*t*x15*x29*x91*x92 - x124*x233 - x127*x35 + 8*x15*x28*x29*x33*x37*x9 - 4*x22*x292 - x236*x35 - x237*x35 - x240*x35 - x285*x292 + (1/2)*x33*x37*x40*x41*x5 + (1/2)*x33*x40*x41*x5 + (1/2)*x36*x40*x41*x5 - x6*x88
    d4L[...,9] = 2*t*x12*x13*x40*x41*x5 + t*x12*x21*x40*x41*x5 - x134*x35 - x137*x35 + 8*x15*x28*x29*x33*x37 - x195*x35 - x291 - 2*x35
    d4L[...,10] = -x113*x116*x310 + x134*x298 + x137*x298 - x14*x305*x42 - x164*x22*x49 + x164*x270 + x195*x298 + x201*x302 - x206*x243 + 24*x213*x39 - x22*x303*x96 - x224*x298 - 24*x227*x245 - x228*x302 - x231*x309 + x242*x254 + x253*x309 + x293*x33 + x293*x36 + x293*x38 - x293 + x296*x33 + x296*x36 + x296*x38 - x296 - x297*x33 - x297*x36 - x297*x38 + x297 + x303*x304 + x305*x306 + x307*x308 + x310*x311
    d4L[...,11] = 6*t*x118*x33*x37*x61*x79 + 6*t*x118*x33*x61*x79 + 6*t*x118*x36*x61*x79 + 3*t*x139*x140*x9*x95 + 5*t*x16*x33*x37*x41*x60*x9 + 5*t*x16*x33*x41*x60*x9 + 5*t*x16*x36*x41*x60*x9 + 2*t*x18*x40*x9 + 8*t*x29*x49*x8 - x10*x313 + 12*x118*x12*x13*x28*x61*x79*x9 + 6*x118*x12*x21*x28*x61*x79*x9 + 5*x12*x13*x16*x41*x60 + 3*x12*x139*x140*x21*x95 + 2*x12*x18*x21*x40 - x127*x146 - x133*x312 - 16*x136*x26 - x14*x316 - x14*x320*x321 - x146*x236 - x146*x237 - x146*x240 + 6*x16*x28*x41*x60*x91*x92 + 8*x16*x33*x37*x41*x60*x87*x9 - x162*x22*x321 - x22*x313 - x224*x314 - x226*x318 - x27*x322 + 8*x28*x29*x49*x8*x9*x91*x92 - x315*x33 - x315*x36 - x317*x33 - x317*x36 - x317*x38 - x319*x33 - x319*x36 - x319*x38 - x323*x9
    d4L[...,12] = 3*t*x139*x140*x95 + 5*t*x16*x33*x37*x41*x60 + 5*t*x16*x33*x41*x60 + 5*t*x16*x36*x41*x60 + 2*t*x18*x40 - x103*x113 + 12*x118*x12*x13*x28*x61*x79 + 6*x118*x12*x21*x28*x61*x79 - x134*x146 - x136*x289 - x137*x146 - x138*x33 - x138*x36 - x138*x38 - x143*x33 - x143*x36 - x143*x38 - x145 - x146*x195 + 8*x16*x33*x37*x41*x60*x87 - x22*x322 + 8*x28*x29*x49*x8*x91*x92 - x323
    d4L[...,13] = -x116*x330 + x127*x150 - x127*x23 + x157*x24 - x157*x51 + x158*x47 + x159*x24 - x159*x51 - x181*x24 + x181*x51 + x22*x330 + x286*x47 + x287*x47 + x289*x329 + x290*x47 + x325*x33 + x325*x36 + x325*x38 - x325 + x326*x74 + x326*x75 + x326*x76 - x327*x74 - x327*x75 - x327*x76 - x331*x47
    d4L[...,14] = -x117*x149 + x117*x151 + x149*x86 + x149*x90 - x150*x38 + x150 - x151*x86 - x151*x90 + x152 + x153 - x154 - x155 + x23*x38 - x23 + x236*x47 + x237*x47 + x240*x47 - x280*x47 + x285*x332 + x332*x333 - x332*x376 + x371
    d4L[...,15] = -x117*x24 + x117*x51 + x134*x47 + x137*x47 + x195*x47 - x224*x47 + x24*x86 + x24*x90 + 2*x47 - x51*x86 - x51*x90
    d4L[...,16] = 8*t*x18*x182*x33*x37*x7 + 6*x18*x7*x70*x91*x92 - x183*x20 - x19*x22*x337 - x20*x334 - x20*x335 - x20*x338 - x336*x54
    d4L[...,17] = 8*t*x18*x33*x37*x7*x70 - x158*x20 + 4*x18*x7*x9*x91*x92 - x19*x275 - x19*x339 - x20*x286 - x20*x287 - x20*x290
    d4L[...,18] = 8*t*x18*x33*x37*x7*x9 - x134*x55 - x137*x55 + 2*x18*x7*x91*x92 - x19*x86 - x19*x90 - x195*x55 - 2*x55
    d4L[...,19] = 8*t*x18*x33*x37*x7 - x134*x20 - x137*x20 - x195*x20 - 2*x20
    d4L[...,20] = 48*t*x12*x13*x139*x41*x61 + 15*t*x12*x13*x199*x343*x344 + 45*t*x12*x167*x21*x255*x95 + 24*t*x12*x18*x21*x60*x8 - 40*x101*x245 - x106*x252*x57 + 36*x118*x16*x28*x29 + 24*x12*x13*x167*x255*x87*x95 + 12*x12*x167*x21*x255*x87*x95 - 48*x130 - x134*x341 - x137*x341 + 24*x139*x41*x61*x87*x91*x92 + 8*x140*x166*x185*x33*x37*x79 + 40*x140*x166*x28*x33*x37*x79 + 40*x140*x166*x28*x33*x79 + 40*x140*x166*x28*x36*x79 - x184 + 15*x188*x28*x299*x300 + 48*x189*x48 - x195*x341 - 15*x201*x343*x344 - x242*x245 - 12*x253*x295 - 24*x254*x311 - 45*x295*x304 - x306*x345 - x308*x345 - x33*x340 - x33*x342 - x340*x36 - x340*x38 - x342*x36 - x342*x38
    d4L[...,21] = x127*x172 - x133*x273*x41 + x14*x349 - x14*x353 + x172*x236 + x172*x237 + x172*x240 - x172*x280 + x217*x355 - x218*x348 + x218*x355 + x22*x353 + x226*x351 - x230*x351 - 12*x26*x356 + 24*x26*x357 - 6*x27*x356 + x27*x358 - x33*x346 + x33*x347 + x33*x350 + x33*x352 - x33*x354 - x346*x36 - x346*x38 + x346 + x347*x36 + x347*x38 - x347 + x350*x36 + x350*x38 - x350 + x352*x36 + x352*x38 - x352 - x354*x36 - x354*x38 + x354 + x359*x9 - x360*x9
    d4L[...,22] = x133*x284 + x134*x172 + x137*x172 + x165*x33 + x165*x36 + x165*x38 - x165 + x169*x33 + x169*x36 + x169*x38 - x169 - x171*x33 - x171*x36 - x171*x38 + x171 + x172*x195 - x172*x224 - x217*x356 - x218*x356 + x22*x358 + x252*x357 + x359 - x360
    d4L[...,23] = 4*t*x12*x13*x41*x60*x61*x70 + 2*t*x12*x21*x41*x60*x61*x70 + 8*t*x16*x29*x49*x9*x91*x92 + 4*t*x18*x40*x70*x8*x91*x92 - x127*x173 - x158*x56 + 8*x16*x28*x29*x33*x37*x49*x70 + 2*x16*x29*x49 + 4*x18*x40*x8*x9 - x181*x63 - x236*x362 - x237*x362 - x286*x56 - x287*x56 - x289*x363 - x290*x56 - x33*x361 + 2*x33*x37*x41*x60*x61*x9 + 2*x33*x41*x60*x61*x9 - x36*x361 + 2*x36*x41*x60*x61*x9 - x361*x38 - 4*x362*x76 - x363*x375 - x365*x70 - x366*x70
    d4L[...,24] = 4*t*x12*x13*x41*x60*x61*x9 + 2*t*x12*x21*x41*x60*x61*x9 + 4*t*x16*x29*x49*x91*x92 + 4*t*x18*x40*x8*x9*x91*x92 - x117*x174 - x127*x56 + 8*x16*x28*x29*x33*x37*x49*x9 - x173 - x175*x285 - x175*x333 - x178 - x179 + 2*x18*x40*x8 - x236*x56 - x237*x56 - x240*x56 - x285*x367 + x33*x37*x41*x60*x61 + x33*x41*x60*x61 - x333*x367 + x36*x41*x60*x61 - x372
    d4L[...,25] = 4*t*x12*x13*x41*x60*x61 + 2*t*x12*x21*x41*x60*x61 + 4*t*x18*x40*x8*x91*x92 - x117*x63 - x134*x56 - x137*x56 + 8*x16*x28*x29*x33*x37*x49 - x195*x56 - x365 - x366 - 2*x56
    d4L[...,26] = -x182*x224*x25 + x183*x25 - x219*x64*x70 + x25*x334 + x25*x335 + x25*x338 + x336*x68 + x337*x69
    d4L[...,27] = x158*x25 + x25*x286 + x25*x287 + x25*x290 - x25*x331 + x275*x64 + x339*x64 - x376*x64*x9
    d4L[...,28] = -x117*x64 + x134*x65 + x137*x65 + x195*x65 - x224*x65 + x64*x86 + x64*x90 + 2*x65
    d4L[...,29] = x25*(-x224 + x377)
    d4L[...,30] = x368*x378 - 6/x185
    d4L[...,31] = 8*x182*x33*x37 - x183 - x334 - x335 - x338
    d4L[...,32] = -x158 - x286 - x287 - x290 + 8*x33*x37*x70
    d4L[...,33] = -x127 - x236 - x237 - x240 + 8*x33*x37*x9
    d4L[...,34] = x378
    
    return lnp, d1L, d2L, d3L, d4L
        
            
        
        
    
    
    
    

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu May  4 22:57:55 2023

@author: lukepinkel
"""
import numpy as np
CONST = -1/2*np.log(np.pi) - 1/2*np.log(2)

def _logpdf3(y, m, s, t, v):  
    x0 = t*np.arcsinh((m - y)/s) + v
    lnp = np.log(t) - 1/2*np.log(m**2 - 2*m*y + s**2 + y**2) +\
          np.log(np.cosh(x0)) - 1/2*np.sinh(x0)**2 + CONST# -1/2*np.log(np.pi) - 1/2*np.log(2)
    
    x1 = s**2
    x2 = 2*y
    x3 = m**2 - m*x2 + x1 + y**2
    x4 = 1/x3
    x5 = 2*m - x2
    x6 = (1/2)*x5
    x7 = 1/s
    x8 = m - y
    x9 = np.arcsinh(x7*x8)
    x10 = t*x9
    x11 = v + x10
    x12 = np.sinh(x11)
    x13 = np.cosh(x11)
    x14 = x12*x13
    x15 = 1/x1
    x16 = x8**2
    x17 = x15*x16 + 1
    x18 = 1/np.sqrt(x17)
    x19 = x18*x7
    x20 = t*x19
    x21 = 1/x13
    x22 = x12*x21
    x23 = x15*x18
    x24 = t*x23
    x25 = x24*x8
    x26 = x14*x9
    x27 = x22*x9
    x28 = t**2
    x29 = 1/x17
    x30 = -x5
    x31 = x3**(-2)
    x32 = x31*x5
    x33 = x12**2
    x34 = x28*x29
    x35 = x15*x34
    x36 = x13**2
    x37 = 1/x36
    x38 = x33*x37
    x39 = s**3
    x40 = 1/x39
    x41 = x17**(-3/2)
    x42 = t*x41
    x43 = x40*x42
    x44 = x22*x43
    x45 = x34*x40
    x46 = x45*x8
    x47 = s**(-4)
    x48 = x16*x47
    x49 = x42*x48
    x50 = x19*x33
    x51 = x19*x36
    x52 = x10*x19
    x53 = x34*x48
    x54 = x40*x8
    x55 = 2*t
    x56 = x18*x55
    x57 = x54*x56
    x58 = s**(-5)
    x59 = x8**3
    x60 = x58*x59
    x61 = x42*x60
    x62 = x23*x8
    x63 = x10*x62
    x64 = x33*x62
    x65 = x36*x62
    x66 = x9**2
    x67 = x33*x66
    x68 = x33*x9
    x69 = x36*x9
    x70 = x37*x68
    x71 = 2*x31
    x72 = -x31*x5
    x73 = x17**(-2)
    x74 = x28*x73
    x75 = (3/2)*x5
    x76 = x47*x75
    x77 = x3**(-3)
    x78 = 4*x14
    x79 = t**3
    x80 = x40*x41
    x81 = x79*x80
    x82 = 2*x22
    x83 = x12**3
    x84 = x13**(-3)
    x85 = x17**(-5/2)
    x86 = t*x85
    x87 = x14*x86
    x88 = x5**2
    x89 = 2*x45
    x90 = x16*x58
    x91 = 2*x74*x90
    x92 = x5*x77
    x93 = x58*x6*x74*x8
    x94 = x42*x76
    x95 = x47*x8
    x96 = x41*x79
    x97 = x95*x96
    x98 = 2*x83*x84
    x99 = s**(-6)
    x100 = x16*x75*x99
    x101 = x22*x86
    x102 = x29*x55
    x103 = x102*x15
    x104 = x6*x80
    x105 = 4*x26
    x106 = 2*x27
    x107 = x43*x6
    x108 = 3*x74
    x109 = x59*x99
    x110 = 4*x34*x95
    x111 = s**(-7)
    x112 = x8**4
    x113 = x111*x112
    x114 = x22*x42
    x115 = x90*x96
    x116 = x102*x54
    x117 = x10*x23
    x118 = x41*x48
    x119 = x10*x118
    x120 = 2*x19
    x121 = x66*x78
    x122 = x66*x82
    x123 = x108*x113
    x124 = 6*x34*x90
    x125 = x14*x18
    x126 = 6*t*x95
    x127 = 3*x8**5/s**8
    x128 = 7*x109
    x129 = x109*x96
    x130 = x41*x60
    x131 = x102*x48
    x132 = 2*x54
    x133 = x10*x132*x18
    x134 = 2*x62
    x135 = x9**3
    
 
    x136 = x12*x21
    x137 = x33 + x36 + x38 - 1
    x138 = (3/4)*x58*x88
    x139 = (3/2)*x28*x47*x73
    x140 = x139*x33*x5
    x141 = x46*x98
    x142 = x78 + x82
    x143 = x142 - x98
    

        
    d1L = np.zeros(y.shape+(4,))
    d1L[...,0] = t*x12*x18*x21*x7 - x14*x20 - x4*x6
    d1L[...,1] = -s*x4 + t*x12*x13*x15*x18*x8 - x22*x25
    d1L[...,2] = -x26 + x27 + 1/t
    d1L[...,3] = x136 - x14
    
    
    
    
    
    d2L = np.zeros(y.shape+(10,))
    d2L[...,0] = (1/2)*t*x12*x13*x40*x41*x5 + x15*x28*x29 - 1/2*x30*x32 - x33*x35 - x35*x36 - x35*x38 - x4 - x44*x6
    d2L[...,1] = s*x32 + x14*x24 - x14*x49 - x22*x24 + x22*x49 + x33*x46 + x36*x46 + x38*x46 - x46
    d2L[...,2] = t*x18*x7*x9 - x10*x50 - x10*x51 + x12*x18*x21*x7 - x14*x19 - x38*x52
    d2L[...,3] = t*x18*x7 - x20*x33 - x20*x36 - x20*x38
    d2L[...,4] = t*x12*x13*x41*x58*x59 + 2*t*x12*x18*x21*x40*x8 + 2*x1*x31 - x14*x57 + x16*x28*x29*x47 - x22*x61 - x33*x53 - x36*x53 - x38*x53 - x4
    d2L[...,5] = x10*x64 + x10*x65 + x14*x62 - x22*x62 + x38*x63 - x63
    d2L[...,6] = x137*x25
    d2L[...,7] = -x36*x66 - x37*x67 + x66 - x67 - 1/x28
    d2L[...,8] = -x68 - x69 - x70 + x9
    d2L[...,9] = -x137
    
    
    
    
    
    d3L = np.zeros(y.shape+(20,))
    d3L[...,0] = t*x12*x13*x40*x41 + t*x136*x138*x85 - x138*x87 + x139*x36*x5 + x140*x37 + x140 + 4*x30*x6*x77*(m - y) - x30*x71 + 2*x40*x41*x79*x83*x84 - x44 - x72 - x74*x76 - x78*x81 - x81*x82
    d3L[...,1] = 2*s*x30*x92 + s*x71 - x100*x101 + x100*x87 - x14*x94 + x22*x94 + x33*x89 - x33*x91 - x33*x93 + x36*x89 - x36*x91 - x36*x93 + x38*x89 - x38*x91 - x38*x93 + x78*x97 + x82*x97 - x89 + x91 + x93 - x97*x98
    d3L[...,2] = 2*t*x15*x29 + (1/2)*t*x33*x37*x40*x41*x5*x9 + (1/2)*t*x33*x40*x41*x5*x9 + (1/2)*t*x36*x40*x41*x5*x9 - x10*x104 - x103*x33 - x103*x36 - x103*x38 - x104*x22 - x105*x35 - x106*x35 + (1/2)*x12*x13*x40*x41*x5 + 2*x15*x28*x29*x83*x84*x9
    d3L[...,3] = x107*x33 + x107*x36 + x107*x38 - x107 - x35*x78 - x35*x82 + x35*x98
    d3L[...,4] = 3*t*x111*x112*x12*x21*x85 + 5*t*x12*x13*x16*x41*x58 + 2*t*x12*x18*x21*x40 - 4*x1*x92 - x108*x109 - x110*x33 - x110*x36 - x110*x38 - 3*x113*x87 - 5*x114*x90 - x115*x78 - x115*x82 - x14*x40*x56 + 2*x16*x41*x58*x79*x83*x84 + 4*x28*x29*x47*x8 + 3*x28*x33*x37*x59*x73*x99 + 3*x28*x33*x59*x73*x99 + 3*x28*x36*x59*x73*x99 - x72
    d3L[...,5] = x105*x46 + x106*x46 + x116*x33 + x116*x36 + x116*x38 - x116 + x117*x33 + x117*x36 + x117*x38 - x117 - x118*x14 + x118*x22 - x119*x33 - x119*x36 - x119*x38 + x119 + x14*x23 - x141*x9 - x22*x23
    d3L[...,6] = -x141 + x24*x33 + x24*x36 + x24*x38 - x24 - x33*x49 - x36*x49 - x38*x49 + x46*x78 + x46*x82 + x49
    d3L[...,7] = 2*t*x18*x66*x7*x83*x84 - x120*x68 - x120*x69 - x120*x70 - x121*x20 - x122*x20 + 2*x18*x7*x9
    d3L[...,8] = 2*t*x18*x7*x83*x84*x9 + x18*x7 - x19*x38 - x50 - x51 - x52*x78 - x52*x82
    d3L[...,9] = 2*t*x18*x7*x83*x84 - x20*x78 - x20*x82
    d3L[...,10] = 6*s*x31 - x101*x127 + x114*x128 - x123*x33 - x123*x36 - x123*x38 + x123 + x124*x33 + x124*x36 + x124*x38 - x124 + x125*x126 - x126*x18*x22 + x127*x87 - x128*x14*x42 + x129*x78 + x129*x82 - x129*x98 - 8*x39*x77
    d3L[...,11] = 2*t*x16*x29*x47 + 2*t*x18*x40*x8*x9 + t*x33*x37*x41*x58*x59*x9 + t*x33*x41*x58*x59*x9 + t*x36*x41*x58*x59*x9 - x10*x130 - x105*x53 - x106*x53 + x12*x13*x41*x58*x59 + 2*x12*x18*x21*x40*x8 - x125*x132 - x130*x22 - x131*x33 - x131*x36 - x131*x38 - x133*x33 - x133*x36 - x133*x38 + 2*x16*x28*x29*x47*x83*x84*x9
    d3L[...,12] = 2*t*x18*x40*x8 + t*x33*x37*x41*x58*x59 + t*x33*x41*x58*x59 + t*x36*x41*x58*x59 + 2*x16*x28*x29*x47*x83*x84 - x33*x57 - x36*x57 - x38*x57 - x53*x78 - x53*x82 - x61
    d3L[...,13] = x121*x25 + x122*x25 + x134*x68 + x134*x69 + x134*x70 - x134*x9 - x25*x66*x98
    d3L[...,14] = x38*x62 - x62 + x63*x78 + x63*x82 - x63*x98 + x64 + x65
    d3L[...,15] = x143*x25
    d3L[...,16] = -x135*x143 + 2/x79
    d3L[...,17] = -x121 - x122 + 2*x66*x83*x84
    d3L[...,18] = -x105 - x106 + 2*x83*x84*x9
    d3L[...,19] = -x142 + 2*x83*x84
    
    return lnp, d1L, d2L, d3L
    
    
    
    

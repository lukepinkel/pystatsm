#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu May  4 23:42:46 2023

@author: lukepinkel
"""
import numpy as np
CONST = -1/2*np.log(np.pi) - 1/2*np.log(2)

def _logpdf3(y, m, s, t, v):  
    x0 = v + np.exp(t)*np.arcsinh((m - y)*np.exp(-s))
    lnp = t - 1/2*np.log(m**2 - 2*m*y + y**2 + np.exp(2*s)) +\
           np.log(np.cosh(x0)) - 1/2*np.sinh(x0)**2 + CONST# -1/2*np.log(np.pi) - 1/2*np.log(2)
            
    x1 = 2*y
    x2 = 2*s
    x3 = np.exp(x2)
    x4 = m**2 - m*x1 + x3 + y**2
    x5 = 1/x4
    x6 = 2*m - x1
    x7 = (1/2)*x6
    x8 = np.exp(t)
    x9 = np.exp(-s)
    x10 = m - y
    x11 = x10*x9
    x12 = np.arcsinh(x11)
    x13 = x12*x8
    x14 = v + x13
    x15 = np.sinh(x14)
    x16 = np.cosh(x14)
    x17 = x15*x16
    x18 = np.exp(-x2)
    x19 = x10**2
    x20 = x18*x19
    x21 = x20 + 1
    x22 = 1/np.sqrt(x21)
    x23 = x22*x9
    x24 = x23*x8
    x25 = 1/x16
    x26 = x15*x25
    x27 = x17*x24 - x24*x26
    x28 = x3*x5
    x29 = x11*x22
    x30 = x29*x8
    x31 = x17*x30
    x32 = x26*x30
    x33 = x13*x17
    x34 = -x6
    x35 = x4**(-2)
    x36 = x35*x6
    x37 = np.exp(2*t)
    x38 = 1/x21
    x39 = x16**2
    x40 = x37*x38
    x41 = x18*x40
    x42 = x39*x41
    x43 = x15**2
    x44 = x41*x43
    x45 = 1/x39
    x46 = x43*x45
    x47 = x21**(-3/2)
    x48 = np.exp(-3*s)
    x49 = x47*x48
    x50 = x49*x8
    x51 = x26*x50
    x52 = -1/2*x15*x16*x47*x48*x6*x8 + x51*x7
    x53 = x10*x41
    x54 = x10*x42
    x55 = x10*x44
    x56 = x19*x8
    x57 = x49*x56
    x58 = x26*x57
    x59 = -x17*x57 + x58
    x60 = x12*x37
    x61 = x23*x60
    x62 = x39*x61
    x63 = x43*x61
    x64 = x27 + x46*x61 - x61 + x62 + x63
    x65 = x24*x39 + x24*x43 + x24*x46 - x24
    x66 = 4*s
    x67 = np.exp(x66)
    x68 = x20*x40
    x69 = x39*x68
    x70 = x43*x68
    x71 = x31 - x32
    x72 = x10**3
    x73 = x50*x72
    x74 = x26*x73
    x75 = -x15*x16*x47*x48*x72*x8 + x74
    x76 = x29*x60
    x77 = x39*x76
    x78 = x43*x76
    x79 = x46*x76 + x71 - x76 + x77 + x78
    x80 = x30*x39 + x30*x43 + x30*x46 - x30
    x81 = x12**2
    x82 = x37*x81
    x83 = x39*x82
    x84 = x43*x82
    x85 = -x12*x15*x25*x8 + x33
    x86 = -x12*x8 + x13*x39 + x13*x43 + x13*x46
    x87 = 2*x35
    x88 = (3/2)*x6
    x89 = x21**(-2)
    x90 = np.exp(-x66)
    x91 = x37*x89*x90
    x92 = x4**(-3)
    x93 = 4*x17
    x94 = np.exp(3*t)
    x95 = x49*x94
    x96 = x93*x95
    x97 = 2*x26
    x98 = x95*x97
    x99 = x15**3
    x100 = x16**(-3)
    x101 = x21**(-5/2)
    x102 = np.exp(-5*s)
    x103 = x101*x102
    x104 = x103*x8
    x105 = x104*x17
    x106 = x6**2
    x107 = 2*x19*x91
    x108 = x6*x92
    x109 = x10*x7*x91
    x110 = 2*x100*x99
    x111 = x110*x95
    x112 = x103*x56*x88
    x113 = 2*x41
    x114 = x113*x46 - x113 + 2*x42 + 2*x44
    x115 = x49*x60
    x116 = x12*x38
    x117 = x116*x18
    x118 = x117*x94
    x119 = x118*x97
    x120 = x93*x94
    x121 = x117*x120
    x122 = x50*x7
    x123 = 3*x91
    x124 = x10**4
    x125 = 2*x53
    x126 = x115*x19
    x127 = x23*x81
    x128 = 3*x68
    x129 = x123*x124
    x130 = 3*x10**5
    x131 = x116*x20
    x132 = 3*x76
    x133 = x29*x81
    x134 = x133*x94
    x135 = x12**3
    x136 = x135*x94
    x137 = x15*x25
    x138 = x46*x53
    x139 = -x65
    x140 = x46*x68
    x141 = x46*x82
    x142 = (3/4)*x106
    x143 = x47*x48
    x144 = x143*x8
    x145 = 2*x100*x99
    x146 = (3/2)*x89*x90
    x147 = x146*x37*x43*x6
    x148 = x94*x97
    x149 = x144*x72
    x150 = x149*x43
    x151 = x93 + x97
    d1L = np.zeros(y.shape+(4,))
    d1L[...,0] = -x27 - x5*x7
    d1L[...,1] = -x28 + x31 - x32
    d1L[...,2] = x13*x26 - x33 + 1
    d1L[...,3] = x137 - x17
    
    
    
    
    
    d2L = np.zeros(y.shape+(10,))
    d2L[...,0] = x18*x37*x38 - 1/2*x34*x36 - x41*x46 - x42 - x44 - x5 - x52
    d2L[...,1] = x138 + x27 + x3*x36 - x53 + x54 + x55 + x59
    d2L[...,2] = -x64
    d2L[...,3] = x139
    d2L[...,4] = -x140 + x18*x19*x37*x38 - 2*x28 + 2*x35*x67 - x69 - x70 - x71 - x75
    d2L[...,5] = x79
    d2L[...,6] = x80
    d2L[...,7] = -x141 + x37*x81 - x83 - x84 - x85
    d2L[...,8] = -x86
    d2L[...,9] = -x39 - x43 - x46 + 1
    
    
    
    
    
    d3L = np.zeros(y.shape+(20,))
    d3L[...,0] = x101*x102*x137*x142*x8 - x105*x142 + x143*x145*x94 + x144*x15*x16 + x146*x37*x39*x6 + x147*x45 + x147 + 4*x34*x7*x92*(m - y) - x34*x87 + x35*x6 - x51 - x88*x91 - x96 - x98
    d3L[...,1] = -x10*x111 + x10*x96 + x10*x98 - x107*x39 - x107*x43 - x107*x46 + x107 + 2*x108*x3*x34 - x109*x39 - x109*x43 - x109*x46 + x109 + x112*x17 - x112*x26 + x114 - x17*x50*x88 + x3*x87 + x51*x88
    d3L[...,2] = 2*x100*x12*x18*x38*x94*x99 - x114 - x115*x7 - x119 + (1/2)*x12*x37*x39*x47*x48*x6 + (1/2)*x12*x37*x43*x45*x47*x48*x6 + (1/2)*x12*x37*x43*x47*x48*x6 - x121 - x52
    d3L[...,3] = x110*x41 + x122*x39 + x122*x43 + x122*x46 - x122 - x41*x93 - x41*x97
    d3L[...,4] = 3*x10*x18*x37*x38 + 2*x100*x19*x47*x48*x94*x99 + 3*x101*x102*x124*x15*x25*x8 - 3*x105*x124 - 4*x108*x67 - x123*x72 - 3*x138 + 4*x15*x16*x19*x47*x48*x8 - x19*x96 - x19*x98 - x27 + 2*x3*x35*x6 + 3*x37*x39*x72*x89*x90 + 3*x37*x43*x45*x72*x89*x90 + 3*x37*x43*x72*x89*x90 - 3*x54 - 3*x55 - 4*x58
    d3L[...,5] = -x10*x110*x118 + x10*x119 + x10*x121 + x125*x46 - x125 - x126*x39 - x126*x43 - x126*x46 + x126 + 2*x54 + 2*x55 + x59 + x64
    d3L[...,6] = -x110*x53 - x139 - x39*x57 - x43*x57 - x46*x57 + x53*x93 + x53*x97 + x57
    d3L[...,7] = 2*x100*x22*x81*x9*x94*x99 + 3*x12*x22*x37*x9 - x120*x127 - x127*x148 - x27 - 3*x46*x61 - 3*x62 - 3*x63
    d3L[...,8] = 2*x100*x12*x22*x37*x9*x99 - x61*x93 - x61*x97 - x65
    d3L[...,9] = 2*x100*x22*x8*x9*x99 - x24*x93 - x24*x97
    d3L[...,10] = -x104*x130*x26 + x105*x130 - x111*x72 + x128*x46 - x128 - x129*x39 - x129*x43 - x129*x46 + x129 - 4*x28 + 12*x35*x67 + 3*x69 + 3*x70 + x71 + x72*x96 + x72*x98 - x73*x93 + 4*x74 - 8*x92*np.exp(6*s)
    d3L[...,11] = 2*x100*x12*x18*x19*x38*x94*x99 - x115*x72 + x12*x37*x39*x47*x48*x72 + x12*x37*x43*x45*x47*x48*x72 + x12*x37*x43*x47*x48*x72 - x120*x131 - x131*x148 - 2*x140 + 2*x18*x19*x37*x38 - 2*x69 - 2*x70 - x75 - x79
    d3L[...,12] = x145*x18*x19*x37*x38 + x149*x39 + x150*x45 + x150 - x68*x93 - x68*x97 - x73 - x80
    d3L[...,13] = -x110*x134 + x120*x133 + x132*x46 - x132 + x134*x97 + x71 + 3*x77 + 3*x78
    d3L[...,14] = -x110*x76 + x76*x93 + x76*x97 + x80
    d3L[...,15] = x30*(-x110 + x151)
    d3L[...,16] = 2*x100*x135*x94*x99 - x136*x93 - x136*x97 - 3*x141 + 3*x37*x81 - 3*x83 - 3*x84 - x85
    d3L[...,17] = 2*x100*x37*x81*x99 - x82*x93 - x82*x97 - x86
    d3L[...,18] = 2*x100*x12*x8*x99 - x13*x93 - x13*x97
    d3L[...,19] = 2*x100*x99 - x151
    
    return lnp, d1L, d2L, d3L
    
    
    
    
    
